
product ZAB ERP

table cacreditview
  caption "Credit Limit View"
  columns zid,xcus,xorg,xcrlimit,xcrused,xpaid,xbalance
  primary key zid,xcus

  foreign key
        zid references zbusiness.zid
  end foreign key

  sql create view cacreditview (zid,xcus,xorg,xcrlimit,xcrused,xpaid,xbalance)~
                  as select zid,xcus,xorg,xcrlimit,~
                  isnull((select sum(xtotamt+xvatamt-xdiscamt) from opdoheader where zid=cacus.zid and xcus=cacus.xcus and xdornum in(select xdornum from opdodetail where xdornum=opdoheader.xdornum)),0),~
                  isnull((select sum(xprime) from arhed where xsign<0 and zid=cacus.zid and xcus=cacus.xcus),0),~
                  xcrlimit-isnull(isnull((select sum(xtotamt+xvatamt-xdiscamt) from opdoheader where zid=cacus.zid and xcus=cacus.xcus and xdornum in(select xdornum from opdodetail where xdornum=opdoheader.xdornum)),0),0)+isnull((select sum(xprime) from arhed where xsign<0 and zid=cacus.zid and xcus=cacus.xcus),0) ~
                  from cacus


end table
