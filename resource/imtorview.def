


product ZAB ERP

table imtorview
  caption "Ac Sub View"
  columns zid,xstaff,xposition,xstatustor,xstatusreq,xwh,xdate
  primary key zid,xstaff,xposition,xstatustor,xstatusreq,xwh,xdate
  foreign key
        zid references zbusiness.zid
  end foreign key

  sql create view imtorview (zid,xstaff,xposition,xtornum,xstatustor,xstatusreq,xwh,xfwh,xdate,xdesignation,xdateapp,xtitem,xtypeobj,xreqtype,xrow)~
as select a.zid,a.xpreparer,b.xposition,a.xtornum,a.xstatustor,a.xstatusreq,a.xtwh,a.xfwh,a.xdate,~
(CASE WHEN a.xstatustor in ('Approved','Confirmed','Partial Issue','Checked','Transferred') and isnull(a.xsignatory1,'') = '' and isnull(a.xsignatory2,'') = '' and isnull(a.xsignatory3,'') = '' and isnull(a.xsignatory4,'') = '' then 'MD' else 'Preparer' END) ~
,a.xdate,a.xtitem,a.xtypeobj,a.xreqtype,rank() OVER (ORDER BY a.xdate desc,a.xtornum) from imtorheader a join pdmst b on a.zid=b.zid and a.xpreparer=b.xstaff ~
union all ~
select a.zid,a.xsignatory1,b.xposition,a.xtornum,a.xstatustor,a.xstatusreq,a.xtwh,a.xfwh,a.xdate, ~
(CASE WHEN a.xstatustor in ('Approved','Confirmed','Partial Issue','Checked','Transferred') and isnull(a.xsignatory2,'') = '' and isnull(a.xsignatory3,'') = '' and isnull(a.xsignatory4,'') = '' then 'MD' else 'Signatory 1' END) ~
,a.xsigndate1,a.xtitem,a.xtypeobj,a.xreqtype,rank() OVER (ORDER BY a.xsigndate1 desc,a.xtornum) from imtorheader a join pdmst b on a.zid=b.zid and a.xsignatory1=b.xstaff ~
union all ~
select a.zid,a.xsignatory2,b.xposition,a.xtornum,a.xstatustor,a.xstatusreq,a.xtwh,a.xfwh,a.xdate, ~
(CASE WHEN a.xstatustor in ('Approved','Confirmed','Partial Issue','Checked','Transferred') and isnull(a.xsignatory3,'') = '' and isnull(a.xsignatory4,'') = '' and isnull(a.xsignatory5,'') = '' then 'MD' else 'Signatory 2' END) ~
,a.xsigndate2,a.xtitem,a.xtypeobj,a.xreqtype,rank() OVER (ORDER BY a.xsigndate2 desc,a.xtornum) from imtorheader a join pdmst b on a.zid=b.zid and a.xsignatory2=b.xstaff ~
union all ~
select a.zid,a.xsignatory3,b.xposition,a.xtornum,a.xstatustor,a.xstatusreq,a.xtwh,a.xfwh,a.xdate, ~
(CASE WHEN a.xstatustor in ('Approved','Confirmed','Partial Issue','Checked','Transferred') and isnull(a.xsignatory4,'') = '' and isnull(a.xsignatory5,'') = '' and isnull(a.xsignatory6,'') = '' then 'MD' else 'Signatory 3' END) ~
,a.xsigndate3,a.xtitem,a.xtypeobj,a.xreqtype,rank() OVER (ORDER BY a.xsigndate3 desc,a.xtornum) from imtorheader a join pdmst b on a.zid=b.zid and a.xsignatory3=b.xstaff ~
union all ~
select a.zid,a.xsignatory4,b.xposition,a.xtornum,a.xstatustor,a.xstatusreq,a.xtwh,a.xfwh,a.xdate, ~
(CASE WHEN a.xstatustor in ('Approved','Confirmed','Partial Issue','Checked','Transferred') and isnull(a.xsignatory5,'') = '' and isnull(a.xsignatory6,'') = '' and isnull(a.xsignatory7,'') = '' then 'MD' else 'Signatory 4' END) ~
,a.xsigndate4,a.xtitem,a.xtypeobj,a.xreqtype,rank() OVER (ORDER BY a.xsigndate4 desc,a.xtornum) from imtorheader a join pdmst b on a.zid=b.zid and a.xsignatory4=b.xstaff ~
union all ~
select a.zid,a.xsignatory5,b.xposition,a.xtornum,a.xstatustor,a.xstatusreq,a.xtwh,a.xfwh,a.xdate, ~
(CASE WHEN a.xstatustor in ('Approved','Confirmed','Partial Issue','Checked','Transferred') and isnull(a.xsignatory6,'') = '' and isnull(a.xsignatory7,'') = '' then 'MD' else 'Signatory 5' END) ~
,a.xsigndate5,a.xtitem,a.xtypeobj,a.xreqtype,rank() OVER (ORDER BY a.xsigndate5 desc,a.xtornum) from imtorheader a join pdmst b on a.zid=b.zid and a.xsignatory5=b.xstaff
end table
