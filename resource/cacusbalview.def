product ZAB ERP

table cacusbalview
  caption "Party balance View"

  columns zid,xcus,xorg,xmadd,xtype,xmobile,xprime,xtypetrn
  primary key zid,xvoucher

  foreign key
        zid references zbusiness.zid
  end foreign key

  sql create view cacusbalview(zid,xcus,xorg,xmadd,xtype,xmobile,xprime,xtypetrn) ~
    as select c.zid,c.xcus,c.xorg,c.xmadd,c.xtype,c.xmobile, ~
	CASE WHEN sum((isnull(a.xbase,0)+isnull(xaitbase,0)+isnull(xvatamt,0)+isnull(xadjustbase,0)+isnull(xgainlossbase,0))*a.xsign)<0 THEN -(sum((isnull(a.xbase,0)+isnull(xaitbase,0)+isnull(xvatamt,0)+isnull(xadjustbase,0)+isnull(xgainlossbase,0))*a.xsign)) ~
	WHEN sum((isnull(a.xbase,0)+isnull(xaitbase,0)+isnull(xvatamt,0)+isnull(xadjustbase,0)+isnull(xgainlossbase,0))*a.xsign)>0 THEN sum((isnull(a.xbase,0)+isnull(xaitbase,0)+isnull(xvatamt,0)+isnull(xadjustbase,0)+isnull(xgainlossbase,0))*a.xsign) ~
	ELSE sum((isnull(a.xbase,0)+isnull(xaitbase,0)+isnull(xvatamt,0)+isnull(xadjustbase,0)+isnull(xgainlossbase,0))*a.xsign) END, ~
	CASE WHEN sum((isnull(a.xbase,0)+isnull(xaitbase,0)+isnull(xvatamt,0)+isnull(xadjustbase,0)+isnull(xgainlossbase,0))*a.xsign)<0 THEN 'Cr' ~
	WHEN sum((isnull(a.xbase,0)+isnull(xaitbase,0)+isnull(xvatamt,0)+isnull(xadjustbase,0)+isnull(xgainlossbase,0))*a.xsign)>0 THEN 'Dr' ~
	ELSE '' END ~
	from cacus c left join arhed a on a.zid=c.zid and a.xcus=c.xcus ~
	group by c.zid,c.xcus,c.xorg,c.xmadd,c.xtype,c.xmobile

end table
