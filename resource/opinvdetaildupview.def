product ERP on the Net

table opinvdetaildupview
  caption "Duplicate CI"
   columns zid,xinvnum,xinvref,xitem,xtheircode,xcount,xqtyinv,xqtyinvdup
  primary key zid,xinvnum,xitem
  foreign key
        zid references zbusiness.zid
  end foreign key
 sql create view opinvdetaildupview (zid,xinvnum,xinvref,xitem,xtheircode,xcount,xqtyinv,xqtyinvdup) ~                  
				 as select d.zid,d.xinvnum,h.xinvref,d.xitem,(select xtheircode from caitem where xitem=d.xitem),(select xcount from caitem where xitem=d.xitem),sum(d.xqtyinv) as ciqty,(select isnull(sum(xqtyinv),0) as ciduqty from opinvdetaildup where xinvnum=d.xinvnum and xitem=d.xitem ) ~ 
				from opinvdetail d join opinvheader h on d.zid=h.zid and d.xinvnum=h.xinvnum  group by d.zid, d.xinvnum,h.xinvref,d.xitem

end table