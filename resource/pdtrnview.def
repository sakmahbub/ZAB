
product ZAB ERP

table pdtrnview
  caption "Leave View"
  columns zid,xvoucher,xrow,xyear,xper,xdate,xstaff,xname,xtype,xamount,xpercent,xqty,xarrear,xadjustment,~
          xothours,xtrntype,xlong,xposition,xempcategory,xdayssalded

  primary key zid,xvoucher,xrow

  foreign key
        zid references zbusiness.zid
  end foreign key

  sql create view pdtrnview (zid,xvoucher,xrow,xyear,xper,xdate,xstaff,xname,xtype,xamount,xpercent,xqty,xarrear,xadjustment,xothours,xtrntype,xlong,xposition,xempcategory,xdayssalded)~
                  as select a.zid,a.xvoucher,a.xrow,b.xyear,b.xper,b.xdate,a.xstaff,~
                  (select xname from pdmst where pdmst.zid=a.zid and pdmst.xstaff=a.xstaff),~
                  a.xtype,isnull(a.xamount,0),~
                  isnull(a.xpercent,0),isnull(a.xqty,0),isnull(a.xarrear,0),isnull(a.xadjustment,0),isnull(a.xothours,0),~
                  (select xprops from xcodes where a.zid=xcodes.zid and xtype='PD Transaction Type' and xcode=a.xtype), ~
                  (select xlong from xcodes where a.zid=xcodes.zid and xtype='PD Transaction Type' and xcode=a.xtype),a.xposition,a.xempcategory,~
                  isnull(a.xdayssalded,0) ~
                  from pdtrndetail a join pdtrnheader b on a.zid=b.zid and a.xvoucher=b.xvoucher and a.xempcategory<>'Casual' and a.xtype<>'' ~
                  union all ~

                  select a.zid,a.xvoucher,a.xrow,b.xyear,b.xper,b.xdate,a.xstaff,~
                  (select xname from pdmst where pdmst.zid=a.zid and pdmst.xstaff=a.xstaff),~
                  a.xtype,isnull(a.xamount,0),~
                  isnull(a.xpercent,0),isnull(a.xqty,0),isnull(a.xarrear,0),isnull(a.xadjustment,0),isnull(a.xothours,0),~
                  (select xprops from xcodes where a.zid=xcodes.zid and xtype='PD Transaction Type' and xcode=a.xtype), ~
                  'Normal',a.xposition,a.xempcategory,isnull(a.xdayssalded,0) ~
                  from pdtrndetail a join pdtrnheader b on a.zid=b.zid and a.xvoucher=b.xvoucher and a.xempcategory='Casual' and a.xtype<>''
end table
