product ZAB ERP

table pdathdview
  caption "PP Approval View"
  columns zid,xstaff,xposition,xstatuspor,xstatus,xwh,xdate
  primary key zid,xstaff,xposition,xstatuspor,xstatus,xwh,xdate
  foreign key
        zid references zbusiness.zid
  end foreign key

  sql create view pdathdview (zid,xstaff,xposition,xsid,xyearperdate,xstatus,xstatusreq,xstatuslate,xstatusel,xstatusabsent,xdate,xemplate,xempearly,xempabsent,xdesignation,xsignatory,xdateapp,xrow)~
as select a.zid,a.xstaff,c.xposition,b.xposition,a.xyearperdate,a.xstatus,isnull(a.xstatuslate,''),isnull(a.xstatuslate,''),'','',a.xdate,a.xemplate,0,0,c.xdesignation,'Preparer',a.xdate, ~
	rank() OVER (ORDER BY a.xdate desc,a.xstaff,a.xyearperdate) from pdathd a join pdmst b on a.zid=b.zid and a.xstaff=b.xstaff ~
	join pdmst c on a.zid=c.zid and a.xstaff=c.xstaff where a.xemplate=1 ~
UNION ALL ~
select a.zid,isnull(a.xstaff,''),c.xposition,b.xposition,a.xyearperdate,a.xstatus,isnull(a.xstatuslate,''),isnull(a.xstatuslate,''),'','',a.xdate,a.xemplate,0,0,c.xdesignation,'Signatory1',a.xsigndate1, ~
	rank() OVER (ORDER BY a.xsigndate1 desc,a.xsignatory1,a.xyearperdate) from pdathd a join pdmst b on a.zid=b.zid and a.xsignatory1=b.xstaff ~
	join pdmst c on a.zid=c.zid and a.xstaff=c.xstaff where a.xemplate=1 ~
UNION ALL ~
select a.zid,isnull(a.xstaff,''),c.xposition,b.xposition,a.xyearperdate,a.xstatus,isnull(a.xstatuslate,''),isnull(a.xstatuslate,''),'','',a.xdate,a.xemplate,0,0,c.xdesignation,'Signatory2',a.xsigndate2, ~
	rank() OVER (ORDER BY a.xsigndate2 desc,a.xsignatory2,a.xyearperdate) from pdathd a join pdmst b on a.zid=b.zid and a.xsignatory2=b.xstaff ~
	join pdmst c on a.zid=c.zid and a.xstaff=c.xstaff where a.xemplate=1 ~
UNION ALL ~
select a.zid,isnull(a.xstaff,''),c.xposition,b.xposition,a.xyearperdate,a.xstatus,isnull(a.xstatuslate,''),isnull(a.xstatuslate,''),'','',a.xdate,a.xemplate,0,0,c.xdesignation,'Signatory3',a.xsigndate3, ~
	rank() OVER (ORDER BY a.xsigndate3 desc,a.xsignatory3,a.xyearperdate) from pdathd a join pdmst b on a.zid=b.zid and a.xsignatory3=b.xstaff ~
	join pdmst c on a.zid=c.zid and a.xstaff=c.xstaff where a.xemplate=1 ~
Union ALL ~
select a.zid,a.xstaff,c.xposition,b.xposition,a.xyearperdate,a.xstatus,isnull(a.xstatusel,''),'',isnull(a.xstatusel,''),'',a.xdate,0,xempearly,0,c.xdesignation,'Preparer',a.xdate, ~
	rank() OVER (ORDER BY a.xdate desc,a.xstaff,a.xyearperdate) from pdathd a join pdmst b on a.zid=b.zid and a.xstaff=b.xstaff ~
	join pdmst c on a.zid=c.zid and a.xstaff=c.xstaff where a.xempearly=1 ~
UNION ALL ~
select a.zid,isnull(a.xstaff,''),c.xposition,b.xposition,a.xyearperdate,a.xstatus,isnull(a.xstatusel,''),'',isnull(a.xstatusel,''),'',a.xdate,0,xempearly,0,c.xdesignation,'Signatory1',a.xsigndate4, ~
	rank() OVER (ORDER BY a.xsigndate4 desc,a.xsignatory4,a.xyearperdate) from pdathd a join pdmst b on a.zid=b.zid and a.xsignatory4=b.xstaff ~
	join pdmst c on a.zid=c.zid and a.xstaff=c.xstaff where a.xempearly=1 ~
UNION ALL ~
select a.zid,isnull(a.xstaff,''),c.xposition,b.xposition,a.xyearperdate,a.xstatus,isnull(a.xstatusel,''),'',isnull(a.xstatusel,''),'',a.xdate,0,xempearly,0,c.xdesignation,'Signatory2',a.xsigndate5, ~
	rank() OVER (ORDER BY a.xsigndate5 desc,a.xsignatory5,a.xyearperdate) from pdathd a join pdmst b on a.zid=b.zid and a.xsignatory5=b.xstaff ~
	join pdmst c on a.zid=c.zid and a.xstaff=c.xstaff where a.xempearly=1 ~
UNION ALL ~
select a.zid,isnull(a.xstaff,''),c.xposition,b.xposition,a.xyearperdate,a.xstatus,isnull(a.xstatusel,''),'',isnull(a.xstatusel,''),'',a.xdate,0,xempearly,0,c.xdesignation,'Signatory3',a.xsigndate6, ~
	rank() OVER (ORDER BY a.xsigndate6 desc,a.xsignatory6,a.xyearperdate) from pdathd a join pdmst b on a.zid=b.zid and a.xsignatory6=b.xstaff ~
	join pdmst c on a.zid=c.zid and a.xstaff=c.xstaff where a.xempearly=1 ~
Union ALL ~
select a.zid,a.xstaff,c.xposition,b.xposition,a.xyearperdate,a.xstatus,isnull(a.xstatusabsent,''),'',isnull(a.xstatusabsent,''),'',a.xdate,0,0,xempabsent,c.xdesignation,'Preparer',a.xdate, ~
	rank() OVER (ORDER BY a.xdate desc,a.xstaff,a.xyearperdate) from pdathd a join pdmst b on a.zid=b.zid and a.xstaff=b.xstaff ~
	join pdmst c on a.zid=c.zid and a.xstaff=c.xstaff where a.xempabsent=1 ~
UNION ALL ~
select a.zid,isnull(a.xstaff,''),c.xposition,b.xposition,a.xyearperdate,a.xstatus,isnull(a.xstatusabsent,''),'','',isnull(a.xstatusabsent,''),a.xdate,0,0,xempabsent,c.xdesignation,'Signatory1',a.xsigndate7, ~
	rank() OVER (ORDER BY a.xsigndate7 desc,a.xsignatory7,a.xyearperdate) from pdathd a join pdmst b on a.zid=b.zid and a.xsignatory7=b.xstaff ~
	join pdmst c on a.zid=c.zid and a.xstaff=c.xstaff where a.xempabsent=1 ~
UNION ALL ~
select a.zid,isnull(a.xstaff,''),c.xposition,b.xposition,a.xyearperdate,a.xstatus,isnull(a.xstatusabsent,''),'','',isnull(a.xstatusabsent,''),a.xdate,0,0,xempabsent,c.xdesignation,'Signatory2',a.xsigndate8, ~
	rank() OVER (ORDER BY a.xsigndate8 desc,a.xsignatory8,a.xyearperdate) from pdathd a join pdmst b on a.zid=b.zid and a.xsignatory8=b.xstaff ~
	join pdmst c on a.zid=c.zid and a.xstaff=c.xstaff where a.xempabsent=1 ~
UNION ALL ~
select a.zid,isnull(a.xstaff,''),c.xposition,b.xposition,a.xyearperdate,a.xstatus,isnull(a.xstatusabsent,''),'','',isnull(a.xstatusabsent,''),a.xdate,0,0,xempabsent,c.xdesignation,'Signatory3',a.xsigndate9, ~
	rank() OVER (ORDER BY a.xsigndate9 desc,a.xsignatory9,a.xyearperdate) from pdathd a join pdmst b on a.zid=b.zid and a.xsignatory9=b.xstaff ~
	join pdmst c on a.zid=c.zid and a.xstaff=c.xstaff where a.xempabsent=1			  
end table
