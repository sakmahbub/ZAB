
product ZAB ERP

table cacreditspview
  caption "Credit Limit View"
  columns zid,xcus,xorg,xcrlimit,xcrused,xpaid,xbalance
  primary key zid,xcus

  foreign key
        zid references zbusiness.zid
  end foreign key

  sql create view cacreditspview (zid,xsp,xname,xterritory,xcrlimit,xcrused,xpaid,xbalance) ~
                  as select a.zid,a.xsp,a.xname,a.xterritory,a.xcrlimit,~
				  0,0,~
                  a.xcrlimit-(isnull(isnull((select sum(xnetamt) from opdoheader where zid=a.zid and xsp=a.xsp and xstatusord='Open' and xdornum in(select xdornum from opdodetail where zid=opdoheader.zid and xdornum=opdoheader.xdornum) and xcus in(select xcus from cacus where zid=opdoheader.zid and xcus=opdoheader.xcus and xgcus='Doctor/Chemist') and xpaymentterm='Credit'),0),0)+isnull((select sum(xbalprime) from arhed where xsign>0 and zid=a.zid and xsp=a.xsp and xcus in(select xcus from cacus where zid=arhed.zid and xcus=arhed.xcus and xgcus='Doctor/Chemist') and xpaymentterm='Credit'),0)) ~
                  from cappo a where a.xcrlimit>0
end table
