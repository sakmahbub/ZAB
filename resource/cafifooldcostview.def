
product ZAB ERP

table cafifooldcostview
  caption "FIFO View"
  columns zid,ximtrnnum,xdate,xwh,xitem,xqty,xcost,xqtydel,xbalance

  primary key zid,xitem,xrow

  foreign key
        zid references zbusiness.zid
  end foreign key

  sql create view cafifooldcostview (zid,ximtrnnum,xdate,xwh,xitem,xqty,xcost,xqtydel,xbalance) ~
                  as select im.zid,im.ximtrnnum,im.xdate,im.xwh,im.xitem,im.xqtystk,im.xrate,isnull(temptable.xqtydel,0) qtydel,(im.xqtystk-isnull(temptable.xqtydel,0)) balance ~
		              from imtrn im ~

                  left join (select del.zid,del.xwh,isnull(del.xcostcode,'') xcostcode,del.xitem,sum(isnull(del.xqty,0)) xqtydel from imtrn del ~
                  where del.xsign<0 and del.xdoctype='Old Price' group by del.zid,del.xcostcode,del.xwh,del.xitem)temptable ~
                  on im.zid=temptable.zid and im.xwh=temptable.xwh and im.xitem=temptable.xitem and im.ximtrnnum=temptable.xcostcode ~
		  where im.xsign>0 and im.xqtystk>0 and (im.xqtystk-isnull(temptable.xqtydel,0))>0 and im.xrate>0

end table
