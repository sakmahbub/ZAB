product ZAB ERP

table acbudgetreconview
  caption "Account Budget Reconsolation view"
  columns   zid, xwh, xacc,xyear, xper, xbudgetamt, xexpense

  primary key  zid, xwh, xacc,xyear, xper

  foreign key
        zid references zbusiness.zid
  end foreign key

  sql create view acbudgetreconview as  ~
	(select a.zid, a.xwh, a.xacc, a.xyear, a.xper, a.xbudgetamt,   ~
	(select sum(c.xprime) from acbal c where c.zid=a.zid and c.xwh=a.xwh and c.xacc=a.xacc and c.xyear=a.xyear   ~
	and c.xper=a.xper group by c.zid, c.xwh, c.xacc, c.xyear, c.xper) as xexpense  ~
	 from acbudgetview a where a.xper<>0 )  ~
	UNION ALL   ~
	(select a.zid, a.xwh, a.xacc, a.xyear, 0, sum(a.xbudgetamt),   ~
	(select sum(b.xprime) from acbal b where a.zid=b.zid and a.xwh=b.xwh and a.xacc=b.xacc and a.xyear=b.xyear and b.xper<>0   ~
	group by b.zid, b.xwh, b.xacc, b.xyear ) from acbudgetview a where a.xper<>0 group by a.zid, a.xwh, a.xacc, a.xyear) 	
end table
