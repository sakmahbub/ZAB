product ZAB ERP

table imstock
  caption "Item Warehouse View"
  columns zid,xitem,xwh,xopalc,xqtyit,xqtyrt,xinhand,xavail
  primary key zid,xitem,xwh

  foreign key
        zid references zbusiness.zid
  end foreign key

  sql create view imstock with schemabinding (zid,xitem,xwh,xopalc,xqtyit,xqtyrt,xinhand,xavail) ~
            AS SELECT a.zid,a.xitem,x.xcode,ISNULL(temptableop.opalc,0),ISNULL(temptableit.qtyit,0),ISNULL(temptablert.qtyrt,0),ISNULL(temptableim.inhand,0),~ 
		(ISNULL(temptableim.inhand,0)-ISNULL(temptableop.opalc,0)-ISNULL(temptableit.qtyit,0)-ISNULL(temptablert.qtyrt,0)) ~
           
  
	    FROM ZABDB.dbo.caitem a JOIN ZABDB.dbo.xcodes x ON x.xtype='Branch' AND a.zid=x.zid ~

	    LEFT JOIN ~

	    (SELECT ophd.zid,ophd.xwh,opdt.xitem,SUM(opdt.xqtyord) AS opalc FROM ZABDB.dbo.opdodetail opdt ~
            INNER JOIN ZABDB.dbo.opdoheader ophd ON opdt.zid=ophd.zid AND opdt.xdornum=ophd.xdornum WHERE ophd.xstatusord='Open' GROUP BY ophd.zid,ophd.xwh,opdt.xitem)temptableop on ~
	    temptableop.zid = a.zid AND temptableop.xitem=a.xitem AND temptableop.xwh=x.xcode ~

	    LEFT JOIN ~
	    
	    (SELECT imthd.zid,imthd.xfwh,imtdt.xitem,SUM(imtdt.xqtyord) AS qtyit FROM ZABDB.dbo.imtordetail imtdt ~
            INNER JOIN ZABDB.dbo.imtorheader imthd ON imtdt.zid=imthd.zid AND imtdt.xtornum=imthd.xtornum WHERE imthd.xstatustor='Open' GROUP BY imthd.zid,imthd.xfwh,imtdt.xitem) temptableit ON ~
	    temptableit.zid = a.zid AND temptableit.xitem=a.xitem AND temptableit.xfwh=x.xcode ~

	    LEFT JOIN ~

	    (SELECT imthd.zid,imthd.xtwh,imtdt.xitem,SUM(imtdt.xqtyord)  AS qtyrt FROM ZABDB.dbo.imtordetail imtdt ~
            INNER JOIN ZABDB.dbo.imtorheader imthd ON imtdt.zid=imthd.zid AND imtdt.xtornum=imthd.xtornum WHERE imthd.xstatustor='Open' GROUP BY imthd.zid,imthd.xtwh,imtdt.xitem) temptablert ON ~
	    temptablert.zid = a.zid AND temptablert.xitem=a.xitem AND temptablert.xtwh=x.xcode ~

	    LEFT JOIN ~
	    	
	    (SELECT im.zid,im.xwh,im.xitem,SUM(im.xqty*im.xsign) AS inhand FROM ZABDB.dbo.imtrn im GROUP BY im.zid,im.xwh,im.xitem) temptableim ON temptableim.zid=a.zid ~
	    AND temptableim.zid=a.zid AND temptableim.xitem=a.xitem ANd temptableim.xwh=x.xcode
	    
  end table
